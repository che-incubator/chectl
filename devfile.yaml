#
# Copyright (c) 2019-2021 Red Hat, Inc.
# This program and the accompanying materials are made
# available under the terms of the Eclipse Public License 2.0
# which is available at https://www.eclipse.org/legal/epl-2.0/
#
# SPDX-License-Identifier: EPL-2.0
#
# Contributors:
#   Red Hat, Inc. - initial API and implementation
#

schemaVersion: 2.1.0

metadata:
  name: chectl-dev

components:
  - name: tooling-container
    container: 
      image: 'quay.io/devfile/universal-developer-image:ubi8-latest'
      cpuLimit: 500m
      cpuRequest: 500m
      memoryLimit: 5G
      memoryRequest: 1G
      env:
        - name: KUBECONFIG
          value: /home/user/.kube/config      
commands:
  - id: install-git-autocompletion
    exec:
      label: POST START EVENT - Install git autocompletion
      component: tooling-container
      commandLine: if ! grep -q "source /usr/share/bash-completion/completions/git" $HOME/.bashrc; then echo "source /usr/share/bash-completion/completions/git" >> $HOME/.bashrc; fi
  - id: install-oc-autocompletion
    exec:
      label: POST START EVENT - Install oc autocompletion
      component: tooling-container
      commandLine: |
        oc completion bash > $HOME/oc_bash_completion && \
        if ! grep -q "source \$HOME/oc_bash_completion" $HOME/.bashrc; then echo "source \$HOME/oc_bash_completion" >> $HOME/.bashrc; fi   
events:
  postStart:
    - install-git-autocompletion
    - install-oc-autocompletion


